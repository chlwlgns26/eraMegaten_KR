<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>魔晶剣計算機 ver1.0</title>
<script type="text/javascript">

//ステ振りポイント計算
function calc_point(){
	var level = parseFloat(document.Sword.Level.value);
	var level_plan = parseFloat(document.Sword.Level_Plan.value);
	
	//上がったレベルの数×1.5倍(小数点以下切り上げ)
	document.Sword.StatusPoints.value = Math.ceil((level_plan - level) * 3 / 2);	
}

//魔晶剣計算
function calc_sword(){
		var level = parseFloat(document.Sword.Level.value);
		var loyalty = parseFloat(document.Sword.loyalty.value);
		var power = parseFloat(document.Sword.Power.value);
		var intelligence = parseFloat(document.Sword.Intelligence.value);
		var magic_power = parseFloat(document.Sword.Magic_Power.value);
		var toughness = parseFloat(document.Sword.Toughness.value);
		var speed = parseFloat(document.Sword.Speed.value);
		var luck = parseFloat(document.Sword.Luck.value);
		
		var obe = parseFloat(document.Sword.Obe.value);
		var des = parseFloat(document.Sword.Des.value);
		var tec = parseFloat(document.Sword.Tec.value);
		
		var ele = parseFloat(document.Sword.Ele.value);
		var rep = parseFloat(document.Sword.Rep.value);
		var rep_max = rep;
		var lenght = parseFloat(document.Sword.Lenght.value);
		var heart = parseFloat(document.Sword.Heart.value);
		
		//それぞれの値が上限より大きい、または下限より小さい場合に対する修正
		if(level > 80){
			level = 80;
		}else if(level < 1){
			level = 1;
		}
		if(loyalty > 15000){
			loyalty = 15000;
		}else if(loyalty < 0){
			loyalty = 0;
		}
		if(obe > 10){
			obe = 10;
		}else if(obe < 0){
			obe = 0;
		}
		if(des > 10){
			des = 10;
		}else if(des < 0){
			des = 0;
		}
		if(tec > 10){
			tec = 10;
		}else if(tec < 0){
			tec = 0;
		}
				
		//ステータス補正の計算
		//レベル補正は別の部分で使うので変数に保存しておく
		var level_result = Math.floor(Math.floor((obe + des + tec + 3) / 6) * (level + 20) / 20);
		document.Sword.Level_result.value = level_result;
		
		document.Sword.Power_result.value = Math.floor(Math.floor((des + 1) / 2) * (level + 40) / 40);
		document.Sword.Intelligence_result.value = Math.floor(Math.floor((tec + 1) / 2) * (level + 40) / 40);
		document.Sword.Magic_Power_result.value = Math.floor(Math.floor((des + 1) / 2) * (level + 40) / 40);
		document.Sword.Toughness_result.value = Math.floor(Math.floor((obe + 1) / 2) * (level + 40) / 40);
		document.Sword.Speed_result.value = Math.floor(Math.floor((tec + 1) / 2) * (level + 40) / 40);
		document.Sword.Luck_result.value = Math.floor(Math.floor((obe + 1) / 2) * (level + 40) / 40);
		
		//魔晶剣の性能の計算
		var attack_result = Math.floor((level + 5 + level_result * 2) * 3 / 2) + Math.floor(power * 3 / 2) + Math.floor(toughness / 2);
		var hit_result= (level + 5 + level_result * 2) + Math.floor(speed * 3 / 2) + Math.floor(luck / 2);
		var magic_attack_result = Math.floor((level + 5 + level_result * 2) * 3 / 2) + Math.floor(magic_power * 3 / 2) + Math.floor(intelligence / 2);
		var magic_defense_result = (level + 5 + level_result * 2) + intelligence + Math.floor(luck / 2) + Math.floor(magic_power / 2);
		
		//性能を剣用に修正
		//攻撃力　：1.0倍
		//命中	　：+10
		//魔法威力：0.8倍
		//魔法効果：0.4倍
		hit_result += 10;
		magic_attack_result = Math.floor(magic_attack_result * 8 / 10);
		magic_defense_result = Math.floor(magic_defense_result * 4 / 10);
		
		//忠誠度によって加算
		attack_result += Math.floor(loyalty / 500);
		hit_result += Math.floor(loyalty / 500);
		magic_attack_result += Math.floor(loyalty / 500);
		magic_defense_result += Math.floor(loyalty / 500);
		
		//攻撃回数によって攻撃と命中を修正
		if(rep == 3){
			attack_result = Math.floor(attack_result * 8 / 10);
			hit_result = Math.floor(hit_result * 7 / 10);
		}else if(rep == 2){
			attack_result = Math.floor(attack_result * 7 / 10);
			hit_result = Math.floor(hit_result * 5 / 10);
		}
		
		//範囲による修正
		//単体なら함락状態によって最大攻撃回数が増加する
		//列なら攻撃が９０％。全体なら６０％
		if(lenght == 3){
			attack_result = Math.floor(attack_result * 6 /10);
		}else if(lenght == 2){
			attack_result = Math.floor(attack_result * 9 /10);
		}else if(lenght == 1){
			if(heart == 3){
				rep_max += 2;
			}else if(heart == 2){
				rep_max += 1;
			}
		}
		
		//追加効果によって攻撃と命中を修正。属性による修正は攻撃のみ
		//FREEZE・SHOCKは95%、その他の状態異常は90%、万能は75%
		switch(ele){
			case 1:
				attack_result = Math.floor(attack_result * 95 / 100);
				hit_result = Math.floor(hit_result * 95 / 100);
				break;
			case 2:
				attack_result = Math.floor(attack_result * 75 / 100);
				break;
			case 3:
				attack_result = Math.floor(attack_result * 9 / 10);
				hit_result = Math.floor(hit_result * 9 / 10);
				break;
		}

		//結果の表示
		document.Sword.attack.value = attack_result;
		document.Sword.hit.value = hit_result;
		document.Sword.magic_attack.value = magic_attack_result;
		document.Sword.magic_defense.value = magic_defense_result;
		document.Sword.repeat.value = rep + "－" + rep_max;
}
// -->
</script>
<noscript>
Javascript対応ブラウザで表示してください。
</noscript>
</head>
<body>
<div style="margin-left:20%;">
<h2>魔晶剣計算機</h2>
<!-- 素材悪魔のステータス入力 -->
<form name="Sword">
<p>
	<table>
		<tr>
			<td>素材のレベル</td>
			<td><input type="number" name="Level" value="1" style="width:100px;"></td>
		</tr>
		<tr>
			<td>忠誠度</td>
			<td><input type="number" name="loyalty" value="0" style="width:100px;"></td>
		</tr>
	</table>
</p>
<p>
	<table>
		<tr>
			<td>力</td>
			<td><input type="number" name="Power" value="3" style="width:50px;"></td>
			<td>　従順</td>
			<td><input type="number" name="Obe" min="0" max="10" value="0" style="width:30px;"></td>
		</tr>
		<tr>
			<td>知恵</td>
			<td><input type="number" name="Intelligence" value="3" style="width:50px;"></td>
			<td>　欲望</td>
			<td><input type="number" name="Des" min="0" max="10" value="0" style="width:30px;"></td>
		</tr>
		<tr>
			<td>魔力</td>
			<td><input type="number" name="Magic_Power" value="3" style="width:50px;"></td>
			<td>　技巧</td>
			<td><input type="number" name="Tec" min="0" max="10" value="0" style="width:30px;"></td>
		</tr>
		<tr>
			<td>耐力</td>
			<td><input type="number" name="Toughness" value="3" style="width:50px;"></td>
		</tr>
		<tr>
			<td>速さ</td>
			<td><input type="number" name="Speed" value="3" style="width:50px;"></td>
		</tr>
		<tr>
			<td>運</td>
			<td><input type="number" name="Luck" value="3" style="width:50px;"></td>
		</tr>
	</table>
</p>
<p>
	<div style="display:inline-block; border:2px solid #000; padding:10px;">
	レベルアップ時のステ振りポイント計算用項目
	<b>※入力しなくても魔晶剣の計算は出来ます</b><br>
	レベルをいくつまで上げる予定ですか？： <input type="number" name="Level_Plan" value="1" style="width:50px;">
	<input type="button" value="残りポイント計算" onClick="calc_point(this.form)"><br>
	残りポイント <input type="number" name="StatusPoints" value="0" style="width:40px">
	</div>
</p>
<p>
	<b>属性・追加効果</b>
	<label><input type="radio" name="Ele" value="1">氷結・電撃</label>
	<label><input type="radio" name="Ele" value="2">万能</label>
	<label><input type="radio" name="Ele" value="3">状態異常</label>
	<label><input type="radio" name="Ele" value="4" checked="checked">その他</label>
</p>
<p>
	<b>攻撃範囲</b>
	<label><input type="radio" name="Lenght" value="1" checked="checked">単体</label>
	<label><input type="radio" name="Lenght" value="2">列</label>
	<label><input type="radio" name="Lenght" value="3">全体</label>
</p>
<p>
	<b>攻撃回数</b>
	<label><input type="radio" name="Rep" value="1" checked="checked">1回</label>
	<label><input type="radio" name="Rep" value="2">2回</label>
	<label><input type="radio" name="Rep" value="3">3回</label>
	<b>※範囲が単体で速さが30以上なら2回、50以上なら3回が選択可能</b>
</p>
<p>
	<b>함락</b>
	<label><input type="radio" name="Heart" value="1" checked="checked">無し</label>
	<label><input type="radio" name="Heart" value="2">恋慕・淫乱・服従</label>
	<label><input type="radio" name="Heart" value="3">親愛・娼婦・隷属</label>
</p>

<input type="button" value="計算" onClick="calc_sword(this.form)"><br>

<!-- 計算結果表示-->
<p>
	<table border="2" align="left">
		<tr>
			<td>レベル</td>
			<td><input type="text" name="Level_result" style="width:20px" value="0">　</td>
			<td>力</td>
			<td><input type="text" name="Power_result" style="width:20px" value="0">　</td>
			<td>知恵</td>
			<td><input type="text" name="Intelligence_result" style="width:20px" value="0">　</td>
			<td>魔力</td>
			<td><input type="text" name="Magic_Power_result" style="width:20px" value="0">　</td>
			<td>耐力</td>
			<td><input type="text" name="Toughness_result" style="width:20px" value="0">　</td>
			<td>速さ</td>
			<td><input type="text" name="Speed_result" style="width:20px" value="0">　</td>
			<td>運</td>
			<td><input type="text" name="Luck_result" style="width:20px" value="0">　</td>
		</tr>
		<tr>
			<td>攻撃</td>
			<td><input type="text" name="attack" style="width:40px" value="0"></td>
			<td>命中</td>
			<td><input type="text" name="hit" style="width:40px" value="0"></td>
			<td>魔法威力</td>
			<td><input type="text" name="magic_attack" style="width:40px" value="0"></td>
			<td>魔法効果</td>
			<td><input type="text" name="magic_defense" style="width:40px" value="0"></td>
			<td>攻撃回数</td>
			<td><input type="text" name="repeat" style="width:40px" value="1－1"></td>
		</tr>
	</table>
</p>
</form>
</div>
</body>
</html>